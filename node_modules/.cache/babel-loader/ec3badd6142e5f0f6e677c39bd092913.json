{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import ReactLoading from'react-loading';import{Auth}from\"aws-amplify\";import{API}from\"aws-amplify\";import{Storage}from\"aws-amplify\";var CreatePost=/*#__PURE__*/function(_Component){_inherits(CreatePost,_Component);function CreatePost(props){var _this;_classCallCheck(this,CreatePost);_this=_possibleConstructorReturn(this,_getPrototypeOf(CreatePost).call(this,props));_this.onChangeHandler=function(event){var file=event.target.files[0];if(file&&!file.name){window.alert(\"Please select a file\");return false;}if(file.size>10e6){window.alert(\"Please upload a file smaller than 10 MB\");event.target.value=null;return false;}console.log(event.target.files[0]);_this.setState({selectedFile:event.target.files[0],hasFile:true});};_this.state={username:'',content:'',title:'',date:new Date(),price:0,image:'',users:[],selectedFile:null,hasFile:false,isLoading:false,noUser:true};_this.onChange=_this.onChange.bind(_assertThisInitialized(_this));_this.onSubmit=_this.onSubmit.bind(_assertThisInitialized(_this));return _this;}_createClass(CreatePost,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.setState({users:['testuser'],username:'testuser'});try{Auth.currentAuthenticatedUser().then(function(user){console.log(\"HI\");console.log(user);_this2.setState({noUser:false,name:user.attributes.name,lastname:user.attributes.family_name});});}catch(e){console.log(e);}}},{key:\"onChange\",value:function onChange(e){this.setState(_defineProperty({},e.target.id,e.target.value));}},{key:\"s3Upload\",value:function(){var _s3Upload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){var filename,stored;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:filename=\"\".concat(Date.now(),\"-\").concat(file.name);_context.next=3;return Storage.vault.put(filename,file,{contentType:file.type});case 3:stored=_context.sent;console.log(stored.key);return _context.abrupt(\"return\",stored.key);case 6:case\"end\":return _context.stop();}}},_callee);}));function s3Upload(_x){return _s3Upload.apply(this,arguments);}return s3Upload;}()},{key:\"onSubmit\",value:function(){var _onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var fileKey,post;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();console.log(this.state);if(!(this.state.content===''||this.state.title===''||this.state.file===null)){_context2.next=5;break;}alert(\"Please fill out all fields\");return _context2.abrupt(\"return\");case 5:if(!this.state.selectedFile){_context2.next=11;break;}_context2.next=8;return this.s3Upload(this.state.selectedFile);case 8:_context2.t0=_context2.sent;_context2.next=12;break;case 11:_context2.t0=null;case 12:fileKey=_context2.t0;this.setState({isLoading:true});post={firstname:this.state.name,lastname:this.state.lastname,content:this.state.content,title:this.state.title,file:fileKey};_context2.prev=15;_context2.next=18;return this.createPost(post);case 18:this.props.history.push(\"/\");_context2.next=25;break;case 21:_context2.prev=21;_context2.t1=_context2[\"catch\"](15);alert(_context2.t1);this.setState({isLoading:false});case 25:console.log(post);// window.location = '/'\ncase 26:case\"end\":return _context2.stop();}}},_callee2,this,[[15,21]]);}));function onSubmit(_x2){return _onSubmit.apply(this,arguments);}return onSubmit;}()},{key:\"createPost\",value:function createPost(post){console.log(this.state.name,this.state.lastname,this.state.content);console.log(post);return API.post(\"posts\",\"/posts\",{body:post});}},{key:\"render\",value:function render(){var _this3=this;return React.createElement(\"div\",{className:\"flex items-center h-full w-full\"},this.state.noUser&&React.createElement(\"div\",null,React.createElement(\"p\",null,\"Please login/register to create a post\")),!this.state.noUser&&React.createElement(\"div\",{className:\"container-sm border-2 border-solid border-green-600 max-w-sm mx-auto mt-1/10 bg-white rounded p-10 shadow-lg\"},React.createElement(\"p\",{className:\"w-full block font-sans text-2xl font-bold text-center justify-center mb-14\"},\"Write new Post\"),React.createElement(\"form\",{onSubmit:this.onSubmit},React.createElement(\"div\",{className:\"items-center flex justify-center\"},React.createElement(\"label\",{className:\"font-bold\"},\"Title: \"),React.createElement(\"input\",{type:\"text\",id:\"title\",required:true,className:\"w-32 h-10 border border-solid border-green-600 rounded mb-4\",value:this.state.description,onChange:function onChange(e){return _this3.onChange(e);}})),React.createElement(\"div\",{className:\"items-center flex justify-center\"},React.createElement(\"label\",{className:\"font-bold\"},\"File: \"),React.createElement(\"input\",{type:\"file\",id:\"file\",name:\"file\",className:\"w-auto border border-solid border-green-600 rounded mb-4 \",onChange:function onChange(e){return _this3.onChangeHandler(e);}})),React.createElement(\"div\",{className:\"items-center block justify-center\"},React.createElement(\"label\",{className:\"font-bold\"},\"Description: \"),React.createElement(\"div\",null,React.createElement(\"textarea\",{className:\"w-64 border border-solid border-green-700  rounded h-64 overflow-auto\",value:this.state.content,id:\"content\",onChange:function onChange(e){return _this3.onChange(e);}}))),React.createElement(\"div\",{className:\"items-center flex justify-center\"},React.createElement(\"input\",{type:\"submit\",value:\"Create Post\",className:\"px-4 py-2 rounded border border-solid border-green-400\"})),this.state.isLoading&&React.createElement(\"div\",{className:\"text-center items-center justify-center flex\"},React.createElement(ReactLoading,{type:\"bars\",color:\"#38a169\",height:'20%',width:'20%'})))));}}]);return CreatePost;}(Component);export{CreatePost as default};","map":{"version":3,"sources":["/Users/jonVan/Desktop/GitHub/cmpe172-project1/src/components/create-post.js"],"names":["React","Component","ReactLoading","Auth","API","Storage","CreatePost","props","onChangeHandler","event","file","target","files","name","window","alert","size","value","console","log","setState","selectedFile","hasFile","state","username","content","title","date","Date","price","image","users","isLoading","noUser","onChange","bind","onSubmit","currentAuthenticatedUser","then","user","attributes","lastname","family_name","e","id","filename","now","vault","put","contentType","type","stored","key","preventDefault","s3Upload","fileKey","post","firstname","createPost","history","push","body","description"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport ReactLoading from 'react-loading';\nimport { Auth } from \"aws-amplify\";\nimport { API } from \"aws-amplify\";\nimport { Storage } from \"aws-amplify\";\n\nexport default class CreatePost extends Component{\n    constructor(props){\n        super(props)\n        this.state = {\n            username:'',\n            content:'',\n            title:'',\n            date: new Date(),\n            price:0,\n            image:'',\n            users:[],\n            selectedFile: null,\n            hasFile: false,\n            isLoading: false,\n            noUser: true,\n        }\n        this.onChange = this.onChange.bind(this);\n        this.onSubmit = this.onSubmit.bind(this);\n    }\n    componentDidMount(){\n        this.setState({\n            users:['testuser'],\n            username:'testuser'\n        })\n        try{\n        Auth.currentAuthenticatedUser()\n    .then(user => {\n        console.log(\"HI\");\n        console.log(user);\n        this.setState({noUser:false, name:user.attributes.name, lastname:user.attributes.family_name});})\n    }catch(e){\n      console.log(e);\n    }}\n    onChange(e){\n        this.setState({\n            [e.target.id]:e.target.value\n        });\n    }\n   async s3Upload(file) {\n  const filename = `${Date.now()}-${file.name}`;\n\n  const stored = await Storage.vault.put(filename, file, {\n    contentType: file.type\n  });\nconsole.log(stored.key);\n  return stored.key;\n}\n    async onSubmit(e){\n        e.preventDefault();\n        console.log(this.state);\n        if(this.state.content === '' || this.state.title === '' || this.state.file === null){\n          alert(\"Please fill out all fields\");\n          return;\n        }\n        \n      const fileKey = this.state.selectedFile ? await this.s3Upload(this.state.selectedFile)\n      : null;\n        this.setState({isLoading:true});\n        const post  ={\n            firstname:this.state.name,\n            lastname:this.state.lastname,\n            content:this.state.content,\n            title:this.state.title,\n            file:fileKey\n        }\n    try {\n        await this.createPost(post);\n        this.props.history.push(\"/\");\n      } catch (e) {\n        alert(e);\n        this.setState({isLoading:false});\n      }\n    \n        console.log(post);\n       // window.location = '/'\n    }\n    createPost(post) {\n      console.log(this.state.name,this.state.lastname,this.state.content);\n       console.log(post);\n        return API.post(\"posts\", \"/posts\", {\n            body:post\n        });\n}\n    onChangeHandler=event=>{\n        let file = event.target.files[0];\n    if (file && !file.name) {\n       window.alert(\"Please select a file\");\n       return false;\n    }\n    if (file.size > 10e6) {\n      window.alert(\"Please upload a file smaller than 10 MB\");\n      event.target.value = null;\n      return false;\n    }\n      console.log(event.target.files[0]);\n    this.setState({\n      selectedFile: event.target.files[0],\n      hasFile: true,\n    });\n\n  }\n    render() {\n        return(\n          \n            <div className=\"flex items-center h-full w-full\">\n              {this.state.noUser &&\n                <div><p>Please login/register to create a post</p></div>\n              }\n              {!this.state.noUser && \n            <div className=\"container-sm border-2 border-solid border-green-600 max-w-sm mx-auto mt-1/10 bg-white rounded p-10 shadow-lg\">\n                <p className=\"w-full block font-sans text-2xl font-bold text-center justify-center mb-14\">\n      Write new Post\n        </p>\n      <form onSubmit={this.onSubmit}>\n\n        <div className=\"items-center flex justify-center\"> \n          <label className=\"font-bold\">Title: </label>\n          <input  type=\"text\"\n            id=\"title\"\n              required\n              className=\"w-32 h-10 border border-solid border-green-600 rounded mb-4\"\n              value={this.state.description}\n              onChange={e => this.onChange(e)}\n              />\n        </div>\n        <div className=\"items-center flex justify-center\">\n          <label className=\"font-bold\">File: </label>\n           <input type=\"file\" id=\"file\" name=\"file\" className=\"w-auto border border-solid border-green-600 rounded mb-4 \"\n onChange={e => this.onChangeHandler(e)}/>\n        </div>\n        <div className=\"items-center block justify-center\">\n          <label className=\"font-bold\">Description: </label>\n          <div>\n              <textarea className=\"w-64 border border-solid border-green-700  rounded h-64 overflow-auto\" value={this.state.content} id=\"content\" onChange={e => this.onChange(e)}></textarea>\n          </div>\n        </div>\n\n        <div className=\"items-center flex justify-center\">\n          <input type=\"submit\" value=\"Create Post\" className=\"px-4 py-2 rounded border border-solid border-green-400\" />\n        </div>\n        {this.state.isLoading && \n        <div className=\"text-center items-center justify-center flex\">\n                <ReactLoading type={\"bars\"} color={\"#38a169\"} height={'20%'} width={'20%'} />\n                </div>\n              }\n      </form>\n    </div>\n    }\n    </div>\n    \n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}