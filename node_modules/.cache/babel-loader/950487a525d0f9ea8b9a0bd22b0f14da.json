{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import{API,Storage,Auth}from'aws-amplify';import ReactLoading from'react-loading';import cloneDeep from'lodash/cloneDeep';var ViewPost=/*#__PURE__*/function(_Component){_inherits(ViewPost,_Component);function ViewPost(props){var _this;_classCallCheck(this,ViewPost);_this=_possibleConstructorReturn(this,_getPrototypeOf(ViewPost).call(this,props));_this.onChangeHandler=function(event){var file=event.target.files[0];if(file&&!file.name){window.alert(\"Please select a file\");return false;}if(file.size>10e6){window.alert(\"Please upload a file smaller than 10 MB\");event.target.value=null;return false;}console.log(event.target.files[0]);var holder=_this.state.editPost;holder.files=event.target.files[0];console.log(holder);_this.setState({editPost:holder});};_this.state={post:null,content:'',loaded:false,edit:false,deleting:false,userInfo:{}};_this.changePost=_this.changePost.bind(_assertThisInitialized(_this));_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));return _this;}_createClass(ViewPost,[{key:\"componentDidMount\",value:function componentDidMount(){this.onLoad();}},{key:\"handleChange\",value:function handleChange(e){var holder=this.state.editPost;holder[e.target.id]=e.target.value;this.setState({editPost:holder});}},{key:\"loadNote\",value:function(){var _loadNote=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var postId,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"hi?\");postId=this.props.match.params.id;_context.next=4;return Auth.currentAuthenticatedUser();case 4:user=_context.sent;console.log(user);this.setState({userInfo:user.attributes});if(!(user.attributes.profile===\"admin\")){_context.next=12;break;}console.log(\"here\");return _context.abrupt(\"return\",API.get(\"posts\",\"/adminposts/\".concat(postId)));case 12:console.log(\"HER\");return _context.abrupt(\"return\",API.get(\"posts\",\"/posts/\".concat(postId)));case 14:case\"end\":return _context.stop();}}},_callee,this);}));function loadNote(){return _loadNote.apply(this,arguments);}return loadNote;}()},{key:\"onLoad\",value:function(){var _onLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var post,post2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return this.loadNote();case 3:post=_context2.sent;post=post.length===1?post[0]:post;if(!post.attachment){_context2.next=10;break;}console.log(post.attachment);_context2.next=9;return Storage.vault.get(post.attachment);case 9:post.attachmentURL=_context2.sent;case 10:post2=cloneDeep(post);this.setState({post:post,loaded:true,editPost:post2});console.log(this.state);_context2.next=19;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);this.setState({failed:true});case 19:case\"end\":return _context2.stop();}}},_callee2,this,[[0,15]]);}));function onLoad(){return _onLoad.apply(this,arguments);}return onLoad;}()},{key:\"changePost\",value:function changePost(){var current=this.state.editPost;current.title=\"holder\";this.setState({edit:true,editPost:current});console.log(this.state);}},{key:\"s3Upload\",value:function(){var _s3Upload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var filename,stored;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:filename=\"\".concat(Date.now(),\"-\").concat(file.name);_context3.next=3;return Storage.vault.put(filename,file,{contentType:file.type});case 3:stored=_context3.sent;console.log(stored.key);return _context3.abrupt(\"return\",stored.key);case 6:case\"end\":return _context3.stop();}}},_callee3);}));function s3Upload(_x){return _s3Upload.apply(this,arguments);}return s3Upload;}()},{key:\"startDelete\",value:function(){var _startDelete=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var decision,postId,post;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();decision=window.confirm(\"Confirm deletion of this post.\");if(decision){_context4.next=4;break;}return _context4.abrupt(\"return\");case 4:_context4.prev=4;this.setState({deleting:true});postId=this.props.match.params.id;post={userId:this.state.post.userId};console.log(post);if(!(this.state.userInfo.profile===\"admin\")){_context4.next=15;break;}console.log(\"IN HERE\");_context4.next=13;return API.del(\"posts\",\"/adminposts/\".concat(postId),{body:post});case 13:_context4.next=17;break;case 15:_context4.next=17;return API.del(\"posts\",\"/posts/\".concat(postId));case 17:this.props.history.push(\"/\");_context4.next=24;break;case 20:_context4.prev=20;_context4.t0=_context4[\"catch\"](4);alert(_context4.t0);this.setState({deleting:false});case 24:case\"end\":return _context4.stop();}}},_callee4,this,[[4,20]]);}));function startDelete(_x2){return _startDelete.apply(this,arguments);}return startDelete;}()},{key:\"newSave\",value:function(){var _newSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var newChange,item,fileKey,post,postId;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:e.preventDefault();newChange=false;for(item in this.state.post){if(this.state.post[item]!==this.state.editPost[item]||this.state.editPost.files!==null&&this.state.editPost.files!==undefined){newChange=true;}}if(!(newChange===false)){_context5.next=6;break;}alert(\"No new changes found or Empty field found\");return _context5.abrupt(\"return\");case 6:if(!(newChange===true||this.state.editPost.files!==null&&this.state.editPost.files!==undefined)){_context5.next=29;break;}if(!this.state.editPost.files){_context5.next=13;break;}_context5.next=10;return this.s3Upload(this.state.editPost.files);case 10:_context5.t0=_context5.sent;_context5.next=14;break;case 13:_context5.t0=this.state.post.attachment;case 14:fileKey=_context5.t0;console.log(fileKey);this.setState({isUpdating:true});post={firstname:this.state.editPost.firstname,lastname:this.state.editPost.lastname,content:this.state.editPost.content,title:this.state.editPost.title,file:fileKey};_context5.prev=18;postId=this.props.match.params.id;_context5.next=22;return API.put(\"posts\",\"/posts/\".concat(postId),{body:post});case 22:this.props.history.push('/');_context5.next=29;break;case 25:_context5.prev=25;_context5.t1=_context5[\"catch\"](18);this.setState({isUpdating:false});console.log(_context5.t1);case 29:case\"end\":return _context5.stop();}}},_callee5,this,[[18,25]]);}));function newSave(_x3){return _newSave.apply(this,arguments);}return newSave;}()},{key:\"render\",value:function render(){var _this2=this;return React.createElement(\"div\",null,this.state.failed&&React.createElement(\"div\",null,React.createElement(\"p\",null,\"Unauthorized access (need to login) or post does not exist\")),this.state.loaded&&!this.state.edit&&React.createElement(\"div\",null,React.createElement(\"p\",null,\"This views a Post\"),React.createElement(\"p\",null,\"Title: \",this.state.post.title),React.createElement(\"p\",null,\"Name: \",this.state.post.firstname+\" \"+this.state.post.lastname),React.createElement(\"p\",null,\"Content: \",this.state.post.content),React.createElement(\"p\",null,\"Created: \",new Date(this.state.post.createdAt).toLocaleString()),React.createElement(\"p\",null,\"Updated: \",new Date(this.state.post.updatedAt).toLocaleString()),React.createElement(\"div\",{className:\"flex\"},React.createElement(\"p\",null,\"Click to download file:\"),React.createElement(\"p\",{onClick:function onClick(){return window.location=_this2.state.post.attachmentURL;},className:\"cursor-pointer text-blue-600 hover:text-blue-300\"},this.state.post.attachment)),this.state.userInfo.profile!==\"admin\"&&React.createElement(\"button\",{className:\"h-10 p-2 w-16 rounded text-white bg-green-600 ml-2 mr-2\",onClick:function onClick(){return _this2.changePost();}},\"Edit\"),React.createElement(\"button\",{className:\"h-10 p-2 rounded text-white bg-red-500 ml-2 \",onClick:function onClick(e){return _this2.startDelete(e);}},\"Delete\"),this.state.deleting&&React.createElement(\"div\",{className:\"text-center items-center justify-center flex\"},React.createElement(ReactLoading,{type:\"bars\",color:\"#c53030\",height:'20%',width:'20%'}))),this.state.loaded&&this.state.edit&&React.createElement(\"div\",{className:\"\"},React.createElement(\"p\",null,\"This edits a post\"),React.createElement(\"form\",{className:\"\"},React.createElement(\"label\",{className:\"mb-2\"},\"Title \"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"title\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.title,type:\"text\"})),React.createElement(\"label\",{className:\"mb-2\"},\"First Name\"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"firstname\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.firstname,type:\"text\"})),React.createElement(\"label\",{className:\"mb-2\"},\"Last Name \"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"lastname\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.lastname,type:\"text\"})),React.createElement(\"label\",{className:\"mb-2\"},\"Content \"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"content\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.content,type:\"text\"})),React.createElement(\"div\",null,React.createElement(\"p\",null,\"Current file on reference:\"),React.createElement(\"p\",null,\"Please note that if you upload and save a new file, this current file will be removed.\"),React.createElement(\"p\",{onClick:function onClick(){return window.location=_this2.state.post.attachmentURL;},className:\"cursor-pointer text-blue-600 hover:text-blue-300\"},this.state.post.attachment)),React.createElement(\"div\",null,React.createElement(\"label\",{className:\"font-bold\"},\"File: \"),React.createElement(\"input\",{type:\"file\",id:\"file\",name:\"file\",className:\"w-auto border border-solid border-green-600 rounded mb-4 \",onChange:function onChange(e){return _this2.onChangeHandler(e);}})),React.createElement(\"button\",{className:\"h-10 p-2 w-16 rounded text-white bg-black ml-2 mr-2\",onClick:function onClick(){return _this2.setState({edit:false,editPost:cloneDeep(_this2.state.post)});}},\"Cancel\"),React.createElement(\"button\",{value:\"Save\",className:\"h-10 p-2 rounded text-white bg-green-500 ml-2 \",onClick:function onClick(e){return _this2.newSave(e);}},\"Save \")),this.state.isUpdating&&React.createElement(\"div\",{className:\"text-center items-center justify-center flex\"},React.createElement(ReactLoading,{type:\"bars\",color:\"#38a169\",height:'20%',width:'20%'}))));}}]);return ViewPost;}(Component);export{ViewPost as default};","map":{"version":3,"sources":["/Users/jonVan/Desktop/GitHub/cmpe172-project1/src/components/view-post.js"],"names":["React","Component","API","Storage","Auth","ReactLoading","cloneDeep","ViewPost","props","onChangeHandler","event","file","target","files","name","window","alert","size","value","console","log","holder","state","editPost","setState","post","content","loaded","edit","deleting","userInfo","changePost","bind","handleChange","onLoad","e","id","postId","match","params","currentAuthenticatedUser","user","attributes","profile","get","loadNote","length","attachment","vault","attachmentURL","post2","failed","current","title","filename","Date","now","put","contentType","type","stored","key","preventDefault","decision","confirm","userId","del","body","history","push","newChange","item","undefined","s3Upload","fileKey","isUpdating","firstname","lastname","createdAt","toLocaleString","updatedAt","location","startDelete","newSave"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport {API,Storage,Auth} from 'aws-amplify';\nimport ReactLoading from 'react-loading';\nimport cloneDeep from 'lodash/cloneDeep';\nexport default class ViewPost extends Component{\n    constructor(props){\n        super(props)\n        this.state = {\n            post:null,\n            content:'',\n            loaded:false,\n            edit:false,\n            deleting:false,\n            userInfo: {},\n\n        }\n        this.changePost = this.changePost.bind(this);\n        this.handleChange = this.handleChange.bind(this);\n    }\n        onChangeHandler=event=>{\n        let file = event.target.files[0];\n        if (file && !file.name) {\n        window.alert(\"Please select a file\");\n        return false;\n        }\n        if (file.size > 10e6) {\n        window.alert(\"Please upload a file smaller than 10 MB\");\n        event.target.value = null;\n        return false;\n        }\n        console.log(event.target.files[0]);\n        let holder = this.state.editPost;\n        holder.files = event.target.files[0];\n        console.log(holder);\n        this.setState({editPost:holder});\n}\n    componentDidMount(){\n        this.onLoad();\n    }\n    handleChange(e){\n        let holder = this.state.editPost;\n        holder[e.target.id] = e.target.value;\n        this.setState({editPost:holder});\n    }\n    async loadNote() {\n        console.log(\"hi?\");\n        let postId = this.props.match.params.id;\n        let user = await Auth.currentAuthenticatedUser();\n        console.log(user);\n        this.setState({userInfo:user.attributes});\n        if(user.attributes.profile === \"admin\"){\n            console.log(\"here\");\n            return API.get(\"posts\", `/adminposts/${postId}`);\n        }\n        else{\n            console.log(\"HER\");\n            return API.get(\"posts\", `/posts/${postId}`);\n        }\n        \n    }\n    async onLoad(){\n        try{\n        let post = await this.loadNote();\n        post = post.length === 1 ? post[0] : post;\n        if(post.attachment){\n            console.log(post.attachment);\n            post.attachmentURL = await Storage.vault.get(post.attachment);\n        }\n        let post2 = cloneDeep(post);\n        this.setState({post:post, loaded:true,editPost:post2});\n        console.log(this.state);\n    }\n    catch(e){\n        console.log(e);\n        this.setState({failed:true});\n    }\n\n    }\n    changePost(){\n\n        let current = this.state.editPost;\n        current.title = \"holder\";\n        this.setState({edit:true,editPost:current});\n                        console.log(this.state);\n\n\n    }\n       async s3Upload(file) {\n  const filename = `${Date.now()}-${file.name}`;\n\n  const stored = await Storage.vault.put(filename, file, {\n    contentType: file.type\n  });\nconsole.log(stored.key);\n  return stored.key;\n}\nasync startDelete(e){\n    e.preventDefault();\n    let decision = window.confirm(\n    \"Confirm deletion of this post.\"\n  );\n    if (!decision) {\n    return;\n  }\n  try {\n    this.setState({deleting:true});\n    let postId = this.props.match.params.id;\n    let post = {userId:this.state.post.userId};\n    console.log(post);\n    if(this.state.userInfo.profile === \"admin\"){\n        console.log(\"IN HERE\");\n        await API.del(\"posts\", `/adminposts/${postId}`, {\n            body:post\n        });\n    }\n    else{\n        await API.del(\"posts\", `/posts/${postId}`);\n    }\n\n    this.props.history.push(\"/\");\n  } catch (e) {\n    alert(e);\n    this.setState({deleting:false});\n  }\n}\n async newSave(e){\n        e.preventDefault();\n        let newChange = false;\n        for(let item in this.state.post){\n            if(this.state.post[item] !== this.state.editPost[item] || (this.state.editPost.files !== null && this.state.editPost.files !== undefined)){\n                newChange = true;\n            }\n        }\n        if(newChange === false){\n            alert(\"No new changes found or Empty field found\");\n            return;\n        }\n        if(newChange === true || (this.state.editPost.files !== null && this.state.editPost.files !== undefined)){\n            const fileKey = this.state.editPost.files ? await this.s3Upload(this.state.editPost.files)\n            : this.state.post.attachment;\n            console.log(fileKey);\n            this.setState({isUpdating:true});\n            const post  ={\n                firstname:this.state.editPost.firstname,\n                lastname:this.state.editPost.lastname,\n                content:this.state.editPost.content,\n                title:this.state.editPost.title,\n                file:fileKey\n            }\n            try{\n            let postId = this.props.match.params.id;\n\n            await API.put(\"posts\", `/posts/${postId}`, {\n            body:post\n        });\n            this.props.history.push('/');\n        }catch(e){\n            this.setState({isUpdating:false});\n            console.log(e);\n        }\n    }\n    }\n    render() {\n        return(\n        <div>\n            {this.state.failed &&\n            <div>\n                <p>Unauthorized access (need to login) or post does not exist</p>\n            </div>\n            }\n            {this.state.loaded && !this.state.edit &&\n            <div>\n                            <p>This views a Post</p>\n\n                <p>Title: {this.state.post.title}</p>     \n                <p>Name: {this.state.post.firstname + \" \" + this.state.post.lastname}</p>     \n                <p>Content: {this.state.post.content}</p>     \n                <p>Created: {new Date(this.state.post.createdAt).toLocaleString()}</p>\n               <p>Updated: {new Date(this.state.post.updatedAt).toLocaleString()}</p>\n                <div className=\"flex\"> \n                <p>Click to download file:</p>\n                <p onClick={() => window.location = this.state.post.attachmentURL}className=\"cursor-pointer text-blue-600 hover:text-blue-300\">{this.state.post.attachment}</p>\n                </div>\n                 {this.state.userInfo.profile !== \"admin\" && \n                 <button className=\"h-10 p-2 w-16 rounded text-white bg-green-600 ml-2 mr-2\" onClick={() => this.changePost()}>Edit</button>\n                 }\n                <button className=\"h-10 p-2 rounded text-white bg-red-500 ml-2 \" onClick={(e) => this.startDelete(e)}>Delete</button>\n                {this.state.deleting &&                \n                 <div className=\"text-center items-center justify-center flex\">\n                <ReactLoading type={\"bars\"} color={\"#c53030\"} height={'20%'} width={'20%'} />\n                </div>}\n            </div>\n        }\n        {this.state.loaded && this.state.edit &&\n            <div className=\"\">\n                <p>This edits a post</p>\n                <form className=\"\">\n                <label className=\"mb-2\">Title </label>\n                <div className=\"mb-4\"> \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"title\"  onChange={e => this.handleChange(e)}value={this.state.editPost.title} type=\"text\"/>\n                </div>\n                <label className=\"mb-2\">First Name</label>\n                <div className=\"mb-4\">                 \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"firstname\"  onChange={e => this.handleChange(e)}value={this.state.editPost.firstname} type=\"text\"/>\n                </div>\n                <label className=\"mb-2\">Last Name </label>\n                <div className=\"mb-4\"> \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"lastname\"  onChange={e => this.handleChange(e)}value={this.state.editPost.lastname} type=\"text\"/>\n                </div>\n                <label className=\"mb-2\">Content </label>\n                <div className=\"mb-4\"> \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"content\"  onChange={e => this.handleChange(e)}value={this.state.editPost.content} type=\"text\"/>\n                </div>\n                <div > \n                <p>Current file on reference:</p>\n                <p>Please note that if you upload and save a new file, this current file will be removed.</p>\n                <p onClick={() => window.location = this.state.post.attachmentURL}className=\"cursor-pointer text-blue-600 hover:text-blue-300\">{this.state.post.attachment}</p>\n                </div>\n                <div>\n                <label className=\"font-bold\">File: </label>\n                    <input type=\"file\" id=\"file\" name=\"file\" className=\"w-auto border border-solid border-green-600 rounded mb-4 \"\n                        onChange={e => this.onChangeHandler(e)}/>\n        \n                </div>\n                <button className=\"h-10 p-2 w-16 rounded text-white bg-black ml-2 mr-2\" onClick={() => this.setState({edit:false,editPost:cloneDeep(this.state.post)})}>Cancel</button>\n                <button value=\"Save\" className=\"h-10 p-2 rounded text-white bg-green-500 ml-2 \" onClick={(e) => this.newSave(e)}>Save </button>\n                </form>\n                {this.state.isUpdating &&                \n                 <div className=\"text-center items-center justify-center flex\">\n                <ReactLoading type={\"bars\"} color={\"#38a169\"} height={'20%'} width={'20%'} />\n                </div>}\n            </div>\n        }\n        </div>\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}