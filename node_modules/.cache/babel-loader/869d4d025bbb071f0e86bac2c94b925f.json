{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/jonVan/Desktop/GitHub/cmpe172-project1/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import{API,Storage,Auth}from'aws-amplify';import ReactLoading from'react-loading';import cloneDeep from'lodash/cloneDeep';import AWS from\"aws-sdk\";import config from'../config';var ViewPost=/*#__PURE__*/function(_Component){_inherits(ViewPost,_Component);function ViewPost(props){var _this;_classCallCheck(this,ViewPost);_this=_possibleConstructorReturn(this,_getPrototypeOf(ViewPost).call(this,props));_this.onChangeHandler=function(event){var file=event.target.files[0];if(file&&!file.name){window.alert(\"Please select a file\");return false;}if(file.size>10e6){window.alert(\"Please upload a file smaller than 10 MB\");event.target.value=null;return false;}var holder=_this.state.editPost;holder.files=event.target.files[0];_this.setState({editPost:holder});};_this.state={post:null,content:'',loaded:false,edit:false,deleting:false,userInfo:{}};_this.changePost=_this.changePost.bind(_assertThisInitialized(_this));_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));return _this;}_createClass(ViewPost,[{key:\"componentDidMount\",value:function componentDidMount(){this.onLoad();}},{key:\"handleChange\",value:function handleChange(e){var holder=this.state.editPost;holder[e.target.id]=e.target.value;this.setState({editPost:holder});}},{key:\"loadNote\",value:function(){var _loadNote=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var postId,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:postId=this.props.match.params.id;_context.next=3;return Auth.currentAuthenticatedUser();case 3:user=_context.sent;this.setState({userInfo:user.attributes});if(!(user.attributes.profile===\"admin\")){_context.next=9;break;}return _context.abrupt(\"return\",API.get(\"posts\",\"/adminposts/\".concat(postId)));case 9:return _context.abrupt(\"return\",API.get(\"posts\",\"/posts/\".concat(postId)));case 10:case\"end\":return _context.stop();}}},_callee,this);}));function loadNote(){return _loadNote.apply(this,arguments);}return loadNote;}()},{key:\"onLoad\",value:function(){var _onLoad=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var post,newUrl,post2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return this.loadNote();case 3:post=_context2.sent;post=post.length===1?post[0]:post;if(!post.attachment){_context2.next=16;break;}if(!(this.state.userInfo.profile===\"admin\")){_context2.next=11;break;}newUrl=\"d1b9g4izcjebow.cloudfront.net/private/\"+post.userId+\"/\"+post.attachment;post.attachmentURL=newUrl;_context2.next=16;break;case 11:_context2.next=13;return Storage.vault.get(post.attachment);case 13:post.attachmentURL=_context2.sent;console.log(\"THIS IS FOR THE USER\");console.log(post.attachmentURL);case 16:post2=cloneDeep(post);this.setState({post:post,loaded:true,editPost:post2});_context2.next=24;break;case 20:_context2.prev=20;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);this.setState({failed:true});case 24:case\"end\":return _context2.stop();}}},_callee2,this,[[0,20]]);}));function onLoad(){return _onLoad.apply(this,arguments);}return onLoad;}()},{key:\"changePost\",value:function changePost(){var current=this.state.editPost;current.title=\"holder\";this.setState({edit:true,editPost:current});}},{key:\"s3Upload\",value:function(){var _s3Upload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(file){var filename,stored;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:filename=\"\".concat(Date.now(),\"-\").concat(file.name);_context3.next=3;return Storage.vault.put(filename,file,{contentType:file.type});case 3:stored=_context3.sent;return _context3.abrupt(\"return\",stored.key);case 5:case\"end\":return _context3.stop();}}},_callee3);}));function s3Upload(_x){return _s3Upload.apply(this,arguments);}return s3Upload;}()},{key:\"startDelete\",value:function(){var _startDelete=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var decision,postId,post;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();decision=window.confirm(\"Confirm deletion of this post.\");if(decision){_context4.next=4;break;}return _context4.abrupt(\"return\");case 4:_context4.prev=4;this.setState({deleting:true});postId=this.props.match.params.id;post={userId:this.state.post.userId};if(!(this.state.userInfo.profile===\"admin\")){_context4.next=13;break;}_context4.next=11;return API.del(\"posts\",\"/adminposts/\".concat(postId),{body:post});case 11:_context4.next=15;break;case 13:_context4.next=15;return API.del(\"posts\",\"/posts/\".concat(postId));case 15:this.props.history.push(\"/\");_context4.next=22;break;case 18:_context4.prev=18;_context4.t0=_context4[\"catch\"](4);alert(_context4.t0);this.setState({deleting:false});case 22:case\"end\":return _context4.stop();}}},_callee4,this,[[4,18]]);}));function startDelete(_x2){return _startDelete.apply(this,arguments);}return startDelete;}()},{key:\"newSave\",value:function(){var _newSave=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var newChange,item,fileKey,post,postId;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:e.preventDefault();newChange=false;for(item in this.state.post){if(this.state.post[item]!==this.state.editPost[item]||this.state.editPost.files!==null&&this.state.editPost.files!==undefined){newChange=true;}}if(!(newChange===false)){_context5.next=6;break;}alert(\"No new changes found or Empty field found\");return _context5.abrupt(\"return\");case 6:if(!(newChange===true||this.state.editPost.files!==null&&this.state.editPost.files!==undefined)){_context5.next=27;break;}if(!this.state.editPost.files){_context5.next=13;break;}_context5.next=10;return this.s3Upload(this.state.editPost.files);case 10:_context5.t0=_context5.sent;_context5.next=14;break;case 13:_context5.t0=this.state.post.attachment;case 14:fileKey=_context5.t0;this.setState({isUpdating:true});post={firstname:this.state.editPost.firstname,lastname:this.state.editPost.lastname,content:this.state.editPost.content,title:this.state.editPost.title,file:fileKey};_context5.prev=17;postId=this.props.match.params.id;_context5.next=21;return API.put(\"posts\",\"/posts/\".concat(postId),{body:post});case 21:this.props.history.push('/');_context5.next=27;break;case 24:_context5.prev=24;_context5.t1=_context5[\"catch\"](17);this.setState({isUpdating:false});case 27:case\"end\":return _context5.stop();}}},_callee5,this,[[17,24]]);}));function newSave(_x3){return _newSave.apply(this,arguments);}return newSave;}()},{key:\"render\",value:function render(){var _this2=this;return React.createElement(\"div\",null,this.state.failed&&React.createElement(\"div\",null,React.createElement(\"p\",null,\"Unauthorized access (need to login) or post does not exist\")),this.state.loaded&&!this.state.edit&&React.createElement(\"div\",null,React.createElement(\"p\",null,\"This views a Post\"),React.createElement(\"p\",null,\"Title: \",this.state.post.title),React.createElement(\"p\",null,\"Name: \",this.state.post.firstname+\" \"+this.state.post.lastname),React.createElement(\"p\",null,\"Content: \",this.state.post.content),React.createElement(\"p\",null,\"Created: \",new Date(this.state.post.createdAt).toLocaleString()),React.createElement(\"p\",null,\"Updated: \",new Date(this.state.post.updatedAt).toLocaleString()),React.createElement(\"div\",{className:\"flex\"},React.createElement(\"p\",null,\"Click to download file:\"),React.createElement(\"a\",{onClick:function onClick(){return window.location.assign(_this2.state.post.attachmentURL);},className:\"cursor-pointer text-blue-600 hover:text-blue-300\"},this.state.post.attachment)),this.state.userInfo.profile!==\"admin\"&&React.createElement(\"button\",{className:\"h-10 p-2 w-16 rounded text-white bg-green-600 ml-2 mr-2\",onClick:function onClick(){return _this2.changePost();}},\"Edit\"),React.createElement(\"button\",{className:\"h-10 p-2 rounded text-white bg-red-500 ml-2 \",onClick:function onClick(e){return _this2.startDelete(e);}},\"Delete\"),this.state.deleting&&React.createElement(\"div\",{className:\"text-center items-center justify-center flex\"},React.createElement(ReactLoading,{type:\"bars\",color:\"#c53030\",height:'20%',width:'20%'}))),this.state.loaded&&this.state.edit&&React.createElement(\"div\",{className:\"\"},React.createElement(\"p\",null,\"This edits a post\"),React.createElement(\"form\",{className:\"\"},React.createElement(\"label\",{className:\"mb-2\"},\"Title \"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"title\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.title,type:\"text\"})),React.createElement(\"label\",{className:\"mb-2\"},\"First Name\"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"firstname\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.firstname,type:\"text\"})),React.createElement(\"label\",{className:\"mb-2\"},\"Last Name \"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"lastname\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.lastname,type:\"text\"})),React.createElement(\"label\",{className:\"mb-2\"},\"Content \"),React.createElement(\"div\",{className:\"mb-4\"},React.createElement(\"input\",{class:\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"content\",onChange:function onChange(e){return _this2.handleChange(e);},value:this.state.editPost.content,type:\"text\"})),React.createElement(\"div\",null,React.createElement(\"p\",null,\"Current file on reference:\"),React.createElement(\"p\",null,\"Please note that if you upload and save a new file, this current file will be removed.\"),React.createElement(\"p\",{onClick:function onClick(){return window.location=_this2.state.post.attachmentURL;},className:\"cursor-pointer text-blue-600 hover:text-blue-300\"},this.state.post.attachment)),React.createElement(\"div\",null,React.createElement(\"label\",{className:\"font-bold\"},\"File: \"),React.createElement(\"input\",{type:\"file\",id:\"file\",name:\"file\",className:\"w-auto border border-solid border-green-600 rounded mb-4 \",onChange:function onChange(e){return _this2.onChangeHandler(e);}})),React.createElement(\"button\",{className:\"h-10 p-2 w-16 rounded text-white bg-black ml-2 mr-2\",onClick:function onClick(){return _this2.setState({edit:false,editPost:cloneDeep(_this2.state.post)});}},\"Cancel\"),React.createElement(\"button\",{value:\"Save\",className:\"h-10 p-2 rounded text-white bg-green-500 ml-2 \",onClick:function onClick(e){return _this2.newSave(e);}},\"Save \")),this.state.isUpdating&&React.createElement(\"div\",{className:\"text-center items-center justify-center flex\"},React.createElement(ReactLoading,{type:\"bars\",color:\"#38a169\",height:'20%',width:'20%'}))));}}]);return ViewPost;}(Component);export{ViewPost as default};","map":{"version":3,"sources":["/Users/jonVan/Desktop/GitHub/cmpe172-project1/src/components/view-post.js"],"names":["React","Component","API","Storage","Auth","ReactLoading","cloneDeep","AWS","config","ViewPost","props","onChangeHandler","event","file","target","files","name","window","alert","size","value","holder","state","editPost","setState","post","content","loaded","edit","deleting","userInfo","changePost","bind","handleChange","onLoad","e","id","postId","match","params","currentAuthenticatedUser","user","attributes","profile","get","loadNote","length","attachment","newUrl","userId","attachmentURL","vault","console","log","post2","failed","current","title","filename","Date","now","put","contentType","type","stored","key","preventDefault","decision","confirm","del","body","history","push","newChange","item","undefined","s3Upload","fileKey","isUpdating","firstname","lastname","createdAt","toLocaleString","updatedAt","location","assign","startDelete","newSave"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport {API,Storage,Auth} from 'aws-amplify';\nimport ReactLoading from 'react-loading';\nimport cloneDeep from 'lodash/cloneDeep';\nimport AWS from \"aws-sdk\";\nimport config from '../config';\nexport default class ViewPost extends Component{\n    constructor(props){\n        super(props)\n        this.state = {\n            post:null,\n            content:'',\n            loaded:false,\n            edit:false,\n            deleting:false,\n            userInfo: {},\n\n        }\n        this.changePost = this.changePost.bind(this);\n        this.handleChange = this.handleChange.bind(this);\n    }\n        onChangeHandler=event=>{\n        let file = event.target.files[0];\n        if (file && !file.name) {\n        window.alert(\"Please select a file\");\n        return false;\n        }\n        if (file.size > 10e6) {\n        window.alert(\"Please upload a file smaller than 10 MB\");\n        event.target.value = null;\n        return false;\n        }\n        let holder = this.state.editPost;\n        holder.files = event.target.files[0];\n        this.setState({editPost:holder});\n}\n    componentDidMount(){\n        this.onLoad();\n    }\n    handleChange(e){\n        let holder = this.state.editPost;\n        holder[e.target.id] = e.target.value;\n        this.setState({editPost:holder});\n    }\n    async loadNote() {\n        let postId = this.props.match.params.id;\n        let user = await Auth.currentAuthenticatedUser();\n        this.setState({userInfo:user.attributes});\n        if(user.attributes.profile === \"admin\"){\n            return API.get(\"posts\", `/adminposts/${postId}`);\n        }\n        else{\n            return API.get(\"posts\", `/posts/${postId}`);\n        }\n        \n    }\n    async onLoad(){\n        try{\n        let post = await this.loadNote();\n        post = post.length === 1 ? post[0] : post;\n        if(post.attachment){\n            if(this.state.userInfo.profile === \"admin\"){\n                let newUrl = \"d1b9g4izcjebow.cloudfront.net/private/\" + post.userId + \"/\" + post.attachment;\n                post.attachmentURL = newUrl;\n            }\n            else{\n            post.attachmentURL = await Storage.vault.get(post.attachment);\n            console.log(\"THIS IS FOR THE USER\");\n            console.log(post.attachmentURL);\n        }}\n        let post2 = cloneDeep(post);\n        this.setState({post:post, loaded:true,editPost:post2});\n\n    }\n    catch(e){\n        console.log(e);\n        this.setState({failed:true});\n    }\n\n    }\n    changePost(){\n\n        let current = this.state.editPost;\n        current.title = \"holder\";\n        this.setState({edit:true,editPost:current});\n\n\n    }\n       async s3Upload(file) {\n  const filename = `${Date.now()}-${file.name}`;\n\n  const stored = await Storage.vault.put(filename, file, {\n    contentType: file.type\n  });\n  return stored.key;\n}\nasync startDelete(e){\n    e.preventDefault();\n    let decision = window.confirm(\n    \"Confirm deletion of this post.\"\n  );\n    if (!decision) {\n    return;\n  }\n  try {\n    this.setState({deleting:true});\n    let postId = this.props.match.params.id;\n    let post = {userId:this.state.post.userId};\n    if(this.state.userInfo.profile === \"admin\"){\n        await API.del(\"posts\", `/adminposts/${postId}`, {\n            body:post\n        });\n    }\n    else{\n        await API.del(\"posts\", `/posts/${postId}`);\n    }\n\n    this.props.history.push(\"/\");\n  } catch (e) {\n    alert(e);\n    this.setState({deleting:false});\n  }\n}\n async newSave(e){\n        e.preventDefault();\n        let newChange = false;\n        for(let item in this.state.post){\n            if(this.state.post[item] !== this.state.editPost[item] || (this.state.editPost.files !== null && this.state.editPost.files !== undefined)){\n                newChange = true;\n            }\n        }\n        if(newChange === false){\n            alert(\"No new changes found or Empty field found\");\n            return;\n        }\n        if(newChange === true || (this.state.editPost.files !== null && this.state.editPost.files !== undefined)){\n            const fileKey = this.state.editPost.files ? await this.s3Upload(this.state.editPost.files)\n            : this.state.post.attachment;\n            this.setState({isUpdating:true});\n            const post  ={\n                firstname:this.state.editPost.firstname,\n                lastname:this.state.editPost.lastname,\n                content:this.state.editPost.content,\n                title:this.state.editPost.title,\n                file:fileKey\n            }\n            try{\n            let postId = this.props.match.params.id;\n\n            await API.put(\"posts\", `/posts/${postId}`, {\n            body:post\n        });\n            this.props.history.push('/');\n        }catch(e){\n            this.setState({isUpdating:false});\n        }\n    }\n    }\n    render() {\n        return(\n        <div>\n            {this.state.failed &&\n            <div>\n                <p>Unauthorized access (need to login) or post does not exist</p>\n            </div>\n            }\n            {this.state.loaded && !this.state.edit &&\n            <div>\n                            <p>This views a Post</p>\n\n                <p>Title: {this.state.post.title}</p>     \n                <p>Name: {this.state.post.firstname + \" \" + this.state.post.lastname}</p>     \n                <p>Content: {this.state.post.content}</p>     \n                <p>Created: {new Date(this.state.post.createdAt).toLocaleString()}</p>\n               <p>Updated: {new Date(this.state.post.updatedAt).toLocaleString()}</p>\n                <div className=\"flex\"> \n                <p>Click to download file:</p>\n                <a onClick={() =>    window.location.assign(this.state.post.attachmentURL)}\n                className=\"cursor-pointer text-blue-600 hover:text-blue-300\">{this.state.post.attachment}</a>\n                </div>\n                 {this.state.userInfo.profile !== \"admin\" && \n                 <button className=\"h-10 p-2 w-16 rounded text-white bg-green-600 ml-2 mr-2\" onClick={() => this.changePost()}>Edit</button>\n                 }\n                <button className=\"h-10 p-2 rounded text-white bg-red-500 ml-2 \" onClick={(e) => this.startDelete(e)}>Delete</button>\n                {this.state.deleting &&                \n                 <div className=\"text-center items-center justify-center flex\">\n                <ReactLoading type={\"bars\"} color={\"#c53030\"} height={'20%'} width={'20%'} />\n                </div>}\n            </div>\n        }\n        {this.state.loaded && this.state.edit &&\n            <div className=\"\">\n                <p>This edits a post</p>\n                <form className=\"\">\n                <label className=\"mb-2\">Title </label>\n                <div className=\"mb-4\"> \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"title\"  onChange={e => this.handleChange(e)}value={this.state.editPost.title} type=\"text\"/>\n                </div>\n                <label className=\"mb-2\">First Name</label>\n                <div className=\"mb-4\">                 \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"firstname\"  onChange={e => this.handleChange(e)}value={this.state.editPost.firstname} type=\"text\"/>\n                </div>\n                <label className=\"mb-2\">Last Name </label>\n                <div className=\"mb-4\"> \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"lastname\"  onChange={e => this.handleChange(e)}value={this.state.editPost.lastname} type=\"text\"/>\n                </div>\n                <label className=\"mb-2\">Content </label>\n                <div className=\"mb-4\"> \n                <input class=\"shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\" id=\"content\"  onChange={e => this.handleChange(e)}value={this.state.editPost.content} type=\"text\"/>\n                </div>\n                <div > \n                <p>Current file on reference:</p>\n                <p>Please note that if you upload and save a new file, this current file will be removed.</p>\n                <p onClick={() => window.location = this.state.post.attachmentURL}className=\"cursor-pointer text-blue-600 hover:text-blue-300\">{this.state.post.attachment}</p>\n                </div>\n                <div>\n                <label className=\"font-bold\">File: </label>\n                    <input type=\"file\" id=\"file\" name=\"file\" className=\"w-auto border border-solid border-green-600 rounded mb-4 \"\n                        onChange={e => this.onChangeHandler(e)}/>\n        \n                </div>\n                <button className=\"h-10 p-2 w-16 rounded text-white bg-black ml-2 mr-2\" onClick={() => this.setState({edit:false,editPost:cloneDeep(this.state.post)})}>Cancel</button>\n                <button value=\"Save\" className=\"h-10 p-2 rounded text-white bg-green-500 ml-2 \" onClick={(e) => this.newSave(e)}>Save </button>\n                </form>\n                {this.state.isUpdating &&                \n                 <div className=\"text-center items-center justify-center flex\">\n                <ReactLoading type={\"bars\"} color={\"#38a169\"} height={'20%'} width={'20%'} />\n                </div>}\n            </div>\n        }\n        </div>\n        );\n    }\n}"]},"metadata":{},"sourceType":"module"}